From a9c19fffc92cb85a0f538f59ebad283db77191a1 Mon Sep 17 00:00:00 2001

From: =?UTF-8?q?Moritz=20'Morty'=20Str=C3=BCbe?= <morty@gmx.net>

Subject: [PATCH] Cooja: Load whole simulation before executing it in nogui mode
---
 tools/cooja/java/se/sics/cooja/GUI.java            |    6 +++---
 .../java/se/sics/cooja/plugins/ScriptRunner.java   |    2 --
 2 files changed, 3 insertions(+), 5 deletions(-)

diff --git a/tools/cooja/java/se/sics/cooja/GUI.java b/tools/cooja/java/se/sics/cooja/GUI.java
index d966685..9fdabc4 100644
--- a/tools/cooja/java/se/sics/cooja/GUI.java
+++ b/tools/cooja/java/se/sics/cooja/GUI.java
@@ -3227,14 +3227,14 @@ public class GUI extends Observable {
             logger.fatal("Error: " + e.getMessage(), e);
             System.exit(1);
           }
-          sim.setSpeedLimit(null);
-          sim.startSimulation();
         } else {
           logger.fatal("No test editor controlling simulation, aborting");
           System.exit(1);
         }
       }
-
+      sim.setSpeedLimit(null);
+      sim.startSimulation();
+      
     } else if (args.length > 0 && args[0].startsWith("-applet")) {
 
       String tmpWebPath=null, tmpBuildPath=null, tmpEsbFirmware=null, tmpSkyFirmware=null;
diff --git a/tools/cooja/java/se/sics/cooja/plugins/ScriptRunner.java b/tools/cooja/java/se/sics/cooja/plugins/ScriptRunner.java
index 93e5e7f..fd3084e 100644
--- a/tools/cooja/java/se/sics/cooja/plugins/ScriptRunner.java
+++ b/tools/cooja/java/se/sics/cooja/plugins/ScriptRunner.java
@@ -672,8 +672,6 @@ public class ScriptRunner extends VisPlugin {
       } catch (Exception e) {
         logger.fatal("Error: " + e.getMessage(), e);
       }
-      simulation.setSpeedLimit(null);
-      simulation.startSimulation();
     }
     return true;
   }

From 11e8ede17321b1b249c94124122097ebb68a0ae0 Mon Sep 17 00:00:00 2001

From: =?UTF-8?q?Moritz=20'Morty'=20Str=C3=BCbe?= <morty@gmx.net>

Subject: Improve GUI-Performance
 This improves the performace of Nimbus significantly. Unfortunately it
 also adds compile warnings that can not be suppressed. This will be
 fixed in Java 7.
---
 tools/cooja/java/se/sics/cooja/GUI.java |   34 ++++++++++++++++++++++++++++---
 1 files changed, 31 insertions(+), 3 deletions(-)

diff --git a/tools/cooja/java/se/sics/cooja/GUI.java b/tools/cooja/java/se/sics/cooja/GUI.java
index 95f0268..9490453 100644
--- a/tools/cooja/java/se/sics/cooja/GUI.java
+++ b/tools/cooja/java/se/sics/cooja/GUI.java
@@ -37,6 +37,7 @@ import java.awt.Dialog;
 import java.awt.Dialog.ModalityType;
 import java.awt.Dimension;
 import java.awt.Frame;
+import java.awt.Graphics2D;
 import java.awt.GraphicsDevice;
 import java.awt.GraphicsEnvironment;
 import java.awt.GridLayout;
@@ -61,16 +62,13 @@ import java.io.InputStream;
 import java.io.OutputStream;
 import java.io.PrintStream;
 import java.io.StringReader;
-import java.lang.reflect.Array;
 import java.lang.reflect.InvocationTargetException;
 import java.net.URL;
 import java.net.URLClassLoader;
 import java.security.AccessControlException;
 import java.text.DecimalFormat;
 import java.util.ArrayList;
-import java.util.Arrays;
 import java.util.Collection;
-import java.util.Comparator;
 import java.util.Enumeration;
 import java.util.List;
 import java.util.Observable;
@@ -112,6 +110,7 @@ import javax.swing.JTextPane;
 import javax.swing.KeyStroke;
 import javax.swing.SwingUtilities;
 import javax.swing.ToolTipManager;
+import javax.swing.UIDefaults;
 import javax.swing.UIManager;
 import javax.swing.UIManager.LookAndFeelInfo;
 import javax.swing.UnsupportedLookAndFeelException;
@@ -129,6 +128,8 @@ import org.jdom.input.SAXBuilder;
 import org.jdom.output.Format;
 import org.jdom.output.XMLOutputter;
 
+import com.sun.java.swing.Painter;
+
 import se.sics.cooja.MoteType.MoteTypeCreationException;
 import se.sics.cooja.VisPlugin.PluginRequiresVisualizationException;
 import se.sics.cooja.contikimote.ContikiMoteType;
@@ -1306,6 +1307,33 @@ public class GUI extends Observable {
         updateDesktopSize(this);
         return c;
       }
+      
+      /*
+       * The Nimbus Pane Background is quite slow, as the background is computed.
+       * The fancy desktop is replaced by a mono-color background.
+       * @see javax.swing.JDesktopPane#updateUI()
+       */
+      
+      @Override
+      public void updateUI() {
+          if ("Nimbus".equals(UIManager.getLookAndFeel().getName())) {        	  
+              UIDefaults map = new UIDefaults();
+              Painter<JComponent> painter = new Painter<JComponent>() {
+
+                  @Override
+                  public void paint(Graphics2D g, JComponent c, int width, int height) {
+                      // file using normal desktop color
+                      g.setColor(UIManager.getDefaults().getColor("desktop"));
+                      g.fillRect(0, 0, width, height);
+                  }
+              };
+              map.put("DesktopPane[Enabled].backgroundPainter", painter);
+              putClientProperty("Nimbus.Overrides", map);
+          }
+          super.updateUI();
+      }
+      
+      
     };
     desktop.setDesktopManager(new DefaultDesktopManager() {
 			private static final long serialVersionUID = -5987404936292377152L;
